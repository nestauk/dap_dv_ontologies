import { promises as fs } from 'fs'
import path from 'path'

import dayjs from 'dayjs'
import  customParseFormat from 'dayjs/plugin/customParseFormat.js'
dayjs.extend(customParseFormat)

export const mostRecentBenchmarkFilePath = async function(dirPath) {

    const files = (await fs.readdir(dirPath)).filter((file) =>
		file.startsWith("results_")
	);

    if (files.length === 0)
        throw new Error(`No result files can be found at ${dirPath}`)

    // results are saved like so: results_{YYYY}-{MM}-{DD}_{HH}-{mm}.nt
    const parseDate = (file) => {
        const t = file.slice(0, -7).split('_').slice(1).join(' ')
        return dayjs(t, 'YYYY-MM-DD HH-mm');
    }
    const fileDates = files.map(file => { 
        return {file: file, date: parseDate(file)}
    }).sort((file1, file2) => file2.date - file1.date);

    const mostRecentFileName = fileDates[0].file
    const mostRecentFilePath = path.join(dirPath, mostRecentFileName)
    return mostRecentFilePath
}