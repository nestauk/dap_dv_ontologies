import fetch from 'node-fetch';

const VIRTUOSO_ENDPOINT = 'http://ec2-18-170-45-162.eu-west-2.compute.amazonaws.com:8890/sparql'

const endpoints = {
    'virtuoso': VIRTUOSO_ENDPOINT
}

export const querySparql = async (endpoint, query, options) => {

    if (endpoint in endpoints)
        endpoint = endpoints[endpoint];

    let url = new URL(endpoint)
    url.searchParams.append('query', query);
    for (const [key, value] of Object.entries(options)) {
        url.searchParams.append(key, value);
    }

    let res = await fetch(url);
    if (res.ok) {
        const result = await res.text();
        if (options.file) console.log(`[+] Fetched results for ${options.file}`)
        return result;
    }
    else {
        if (options.file)
            console.error(`[-] Failed to fetch results for ${options.file}`)
        
    }
    
    // if ('file' in options) 
    //     throw new Error(`Couldn't fetch query with file ${options.file}`)
    // throw new Error(
    //     `Couldn't fetch query\n\n${query}\n\nhad error ${res.status}`
    // )
}